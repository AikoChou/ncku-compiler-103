#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#define FILE_NAME "grammar.txt"
char buffer[100]={'\0'}; //暫存要處理的token
int state=0;//state 0表示正在讀入  state 1表示進入結算模式
char text[100][10][30];//文法
char first[100][50][30];//first
char follow[100][50][30];//follow
int invertcheck(int a);

int lltable[30][40][30];
int head=0;//第一個index
int headderivation=0;//第二個index
int derivationword=0;//第三個index
int hdreadygo=0;
int firstfunct(char* target);//找到first 的funct
int followfunct(char* target);//find  follow
int followaddfollow(char* a,char* b);//把follow(a)除了epsilon全加入follow(b)
int followepsiloncheckfunct(char* a);//檢查first中有沒有epsilon
int lltablemake();
int terminalnum(char* a);
int nonterminalnum(char*a);
int printlltable();
int jmaalpha(int j,char* A,char* alpha);//把j加入M[A,alpha]中,注意不重複
int addtoFlltable(char  followorfirst[100][50][30],char* nonterminal,int j,char* A);//把F中所有填入表中
int maketree(char* non,int hir);
char* terminal[]={"Stop","Program","DeclList","DeclList'","Decl","VarDecl","VarDecl'","FunDecl","VarDeclList","ParamDeclList","ParamDeclListTail","ParamDeclListTail'","ParamDecl","ParamDecl'","Block","Type","StmtList","StmtList'","Stmt","Expr","ExprIdTail","ExprArrayTail","Expr'","ExprList","ExprListTail","ExprListTail'","UnaryOp","BinOp",""};
char* terminalk[]={"stop","int","char","double","float",";","(",")",",","{","}","-","!","num","id","return","break","if","while","print","+","*","/","==","!=","<","<=",">",">=","&&","||","$","[","]","=","epsilon",""};
 FILE * token_fp= fopen("token.txt","r");;
 //把token讀入
 //token_fp = fopen("token.txt","r");
  //dest_fp=fopen("token.txt","w");    
 char globalk[20];
 char Type[20],word[20];
 char productionbuffer[10][20];
 FILE* ll=fopen("lltable.txt","w");
 FILE* tree=fopen("tree.txt","w");
 //////////////////////////////////////hw3
 int DeclListplon;
 char DeclListplonType[10];
 char DeclListplonId[100];
 int scoperecord[100];
 int nowscope=1;
 int STarray;
 int STfunct;
 int FunDecl=0;
 int scopein();
 int scopeout(int nowscope);
 int ParamDecl=0;
 char  ParamDeclId[100];
 char ParamDeclType[10];
 int VarDecl=0;
 char  VarDeclId[100];
 char VarDeclType[10];
 int functleft=0;

 struct symboltable
{
        int scope;
            char Symbol[100];
                char Type[10];
                    int array;
                        int  funct;
                            int para;
                                char Rname[15];
};

int symbolcount=0;
struct symboltable SymbolTable[50];
int symbolcountf=0;
int registercount=1;
int nowR=0;
char registernewname[15];
char R[100][15];
int registersupplier(char id[100],int scopenum,int instruction);
int FtableI(char id[100],int nowscopel);
//////////////////////////////////////hw3
//////////////////////////////////////hw3 code
FILE* code=fopen("code.ll","w");
//FILE* =fopen("lltable.txt","w");
//////////////////////////////////////hw3 code
int main()
{
    scoperecord[0]=1;
    int j;
    int comment1=0;
    for(j=0;j<100;j++)buffer[j]='\0';
     FILE *source_fp,*dest_fp;//input ptr和output ptr
      char ch;//現在讀到的char
       source_fp = fopen(FILE_NAME,"r");
        dest_fp=fopen("tokenk.txt","w");
        int line_num=1;//行數
        int buffercount=0;//目前處理到buffer的index
        //////////////////////////////////////////////////////////////////////////////////////////////讀檔
         while((ch=getc(source_fp))!=EOF) //讀入全文
                                                                                        {
                                                                                                                                                                       if(ch=='\n')
                                                                                                                                                                                                                                                                                { 
                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                         buffer[buffercount]='\0';
                                                                                                                                                                                                                                                                                                                                                                                                 strcpy(text[head][headderivation],buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                         buffercount=0;    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                head+=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    headderivation=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         state=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                    if(ch==' '){
                                                                                                                                                                                                                                                                                                                   buffer[buffercount]='\0';
                                                                                                                                                                                                                                                                                                                                                                           strcpy(text[head][headderivation],buffer);
                                                                                                                                                                                                                                                                                                                                                                                                                                   //printf("text[%d][%d]=%s\n",head,headderivation,text[head][headderivation]);
                                                                                                                                                                                                                                                                                                                                                                                                                                   buffercount=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           state=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   headderivation+=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     }
                                                                                                                                                                                                                                                                                                                                 if(ch=='\t'){
                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                         headderivation=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                             state=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                          if(state==0) 
                                                                                                                                                                                                                                                                                                                                                                                                                                       {     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffer[buffercount]=ch;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    buffercount+=1; ;    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }
                                                                                                                                                                                                                                                                                                                                                                                                                                                      state=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }

         int i=0;
         int k=0;
         for(i=0;i<100;i++)
         {//printf("\n");
               for(k=0;k<10;k++)
                           {
                                        // printf("%5s",text[i][k]);
                                       }
         }

         fclose(dest_fp);  
          fclose(source_fp);
          //上面就完成讀檔   製造出一個有文法文件陣列的text[][][]
          //////////////////////////////////////////////////////////////////////////////////////////////讀檔


          k=0;

          //把要做成first的nonterminal   copy過去first

          for(i=0;i<100;i++)
          {
                 if(text[i][0][0]!='\0')
                                     {      
                                                             strcpy(first[k][0],text[i][0]);
                                                                                 strcpy(follow[k][0],text[i][0]);
                                                                                                     k+=1;
                                                                                                                     }
          }


          ////////////////////////////findfirst
          printf("start findfirst\n");
          for(i=0;first[i][0][0]!='\0'&&i!=99;i++)
          {
               //printf("\n");
                firstfunct(first[i][0]);//   把 first 表中的每個元素都丟去找first
          }
          int printuse;
          //printf("\n");
           FILE *firstfollow_fp;
           firstfollow_fp=fopen("set.txt","w");    
           fprintf(firstfollow_fp,"start findfirst\n");
           //print first
           //S_int_char_double_float_Program____
           fprintf(firstfollow_fp,"S_int_char_double_float_Program____");
           /*
              for(i=0;i<100;i++)
              {
                 if( first[i][0][0]!='\0'&&i!=99)
                                 {    
                                                     printf("\n");  
                                                                         fprintf(firstfollow_fp,"\n");  
                                                                                             for(printuse=0;printuse<50;printuse++)
                                                                                                                 {printf("%s_",first[i][printuse]);
                                                                                                                                     fprintf(firstfollow_fp,"%s_",first[i][printuse]);}
                                                                                                                                                     }
                                                                                                                                                     }
                                                                                                                                                     */
           printf("\n");
           ////////////////////////////findfirst


           ////////////////////////////findfollow
           printf("start findfollow\n");
           fprintf(firstfollow_fp,"\nstart findfollow\n");
           //print  follow
            followfunct("XDXD");

            printf("\n");
            //S_$_________________________________________
            fprintf(firstfollow_fp,"S_$_______________________________");
            for(i=0;i<100;i++)
            {
                   if( follow[i][0][0]!='\0'&&i!=99)
                                       {    
                                                           //    printf("\n");
                                                               fprintf(firstfollow_fp,"\n");  
                                                                               //    for(printuse=0;printuse<50;printuse++)
                                                                               //    {printf("%s_",follow[i][printuse]);fprintf(firstfollow_fp,"%s_",follow[i][printuse]);}
                                                                                   //k+=1;
                                                                               }
            }
            printf("\n");
            fclose(firstfollow_fp);
            ////////////////////////////findfollow
            ////////////////////////////lltable
            printf("lltable\n");
             lltablemake();
             //printlltable();
             fclose(ll);
             ll=fopen("dontcare.txt","w");
             ////////////////////////////lltable
             //////////////////////////////////////////////////////tree

             //globalk="int";
             while(fscanf(token_fp,"%s%s",Type,word)!=EOF)
                     {
                                 printf("%s %s\n",Type,word);
                                         break;
                                             } 

             printf(" 1 S\n");
             fprintf(tree," 1 S\n");
             fprintf(code,"target datalayout = \"e-m:e-p:32:32-f64:32:64-f80:32-n8:16:32-S128\"\n");
             fprintf(code,"target triple = \"i386-pc-linux-gnu\"\n");
             maketree("Program",2);
             printf("    2 $\n");
             fprintf(tree,"    2 $\n");
             //maketree("$\n",2);
             fprintf(code,"declare i32 @printf(i8*, ...) #1\n");
             fprintf(code,"attributes #0 = { nounwind \"less-precise-fpmad\"=\"false\" \"no-frame-pointer-elim\"=\"true\" \"no-frame-pointer-elim-non-leaf\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"stack-protector-buffer-size\"=\"8\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\n");
             fprintf(code,"attributes #1 = { \"less-precise-fpmad\"=\"false\" \"no-frame-pointer-elim\"=\"true\" \"no-frame-pointer-elim-non-leaf\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"stack-protector-buffer-size\"=\" 8 \" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\n");
             fprintf(code,"!llvm.ident = !{!0}\n");
             fprintf(code,"!0 = metadata !{metadata !\"Ubuntu clang version 3.5.0-4ubuntu2 (tags/RELEASE_350/final) (based on LLVM 3.5.0)\"}\n");
             //fprintf(code,"\n");
             //////////////////////////////////////////////////////tree


              fclose(ll);
              FILE *table;
              //ll=fopen("dontcare.txt","w");
              table=fopen("table.txt","w");
              printf("scope  symbol     type     array     funct     para\n");
                  fprintf(table,"scope  symbol     type     array     funct     para\n");

                      for(i=0;i<50;i++)
                                  {
                                                  if(strcmp(SymbolTable[i].Symbol,"")==0)break;
                                                              printf("%3d     %5s     %7s     %3d     %3d         %d     %s\n",SymbolTable[i].scope,SymbolTable[i].Symbol,SymbolTable[i].Type,SymbolTable[i].array,SymbolTable[i].funct,SymbolTable[i].para,SymbolTable[i].Rname);
                                                                          fprintf(table,"%3d     %5s     %7s     %3d     %3d         %d     %s\n",SymbolTable[i].scope,SymbolTable[i].Symbol,SymbolTable[i].Type,SymbolTable[i].array,SymbolTable[i].funct,SymbolTable[i].para,SymbolTable[i].Rname);
                                                                                      
                                                                                                                                                          //SymbolTable[symbolcount].array=1;
                                                                                                                              //SymbolTable[symbolcount].funct=0;
                                                                                                                              //SymbolTable[symbolcount].scope=nowscope;
                                                                                                                              //strcpy(SymbolTable[symbolcount].Symbol,ParamDeclId);
                                                                                                                              //strcpy(SymbolTable[symbolcount].Type,ParamDeclType);
                                                                                                                              //SymbolTable[symbolcount].para=1;
                                                                                  }
                                                  /*registersupplier("funct",1,0);
                                                                                printf("%s\n",registernewname);
                                                                                                            
                                                                                                            registersupplier("funct",21,0);
                                                                                                                                        
                                                                                                                                        printf("%s\n",registernewname);
                                                                                                                                                                    registersupplier("funct",21,0);
                                                                                                                                                                                                
                                                                                                                                                                                                printf("%s\n",registernewname);
                                                                                                                                                                                                                            registersupplier("funct",21,0);
                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                        printf("%s\n",registernewname);
                                                                                                                                                                                                                                                                                    registersupplier("funct",21,0);
                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                printf("%s\n",registernewname);
                                                                                                                                                                                                                                                                                                                                            registersupplier("funct",21,1);
                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                        printf("%s\n",registernewname);
                                                                                                                                                                                                                                                                                                                                                                                                    registersupplier("funct",21,1);
                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                printf("%s\n",registernewname);
                                                                                                                                                                                                                                                                                                                                                                                                                                                            registersupplier("funct",21,1);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        printf("%s\n",registernewname);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    */
                                                  //strcpy(SymbolTable[symbolcount].Rname,registernewname);
                                                  //printf(" FtableI%d\n",FtableI("x",21)); 
                       return 0;
}




int firstfunct(char* target)
{    
        int donotfind=0;
            int addfirst1;
                int addfirst2;
                    int posinfirst;
                    //    找到要找的元素在first中的位置
                        for( posinfirst=0; posinfirst<100; posinfirst++)
                                    {    
                                                    
                                                    if(!strcmp(target,first[ posinfirst][0]))
                                                                    {    
                                                                                        
                                                                                        break;
                                                                                                    }
                                                            }
                            

                            int add;
                                int i;//i  pos
                                    //find pos in text找到在text 中的位置
                                    for(i=0;i<100;i++)
                                                {
                                                                
                                                                if(!strcmp(target,text[i][0]))
                                                                                {    
                                                                                                    
                                                                                                    break;
                                                                                                                }
                                                                        }


                                        int j;//j string
                                            
                                            int epsilonindex2;
                                                int epsiloncheck=1;

                                                    for(j=(i+1);j<100;j++)
                                                                {
                                                                    //  找到要找first的nonterminal的每個production
                                                                                
                                                                                if(strcmp("\0",text[j][0]))   //一樣的話就不進入  也就不跳出,沒有production時會跳出
                                                                                                    {
                                                                                                                            
                                                                                                                            
                                                                                                                            break;
                                                                                                                                            }
                                                                                            

                                                                                                epsiloncheck=1;//檢查加入的那個first裡面有沒有epsilon
                                                                                                            for(epsilonindex2=1;epsilonindex2<10&&epsiloncheck;epsilonindex2++)
                                                                                                                            {
                                                                                                                                //epsilonindex2表示有10個項次可能有
                                                                                                                                                epsiloncheck=0;
                                                                                                                                                                

                                                                                                                                                //bigcase
                                                                                                                                                            
                                                                                                                                                            if(64<text[j][epsilonindex2][0]&&text[j][epsilonindex2][0]<91)
                                                                                                                                                                                {

                                                                                                                                                                                    //  把first都加入
                                                                                                                                                                                                        //printf("->");
                                                                                                                                                                                                        add=firstfunct(text[j][epsilonindex2]);


                                                                                                                                                                                                                            for(addfirst1=1;first[add][addfirst1][0]!='\0'&&addfirst1<50;addfirst1++)
                                                                                                                                                                                                                                                        {    
                                                                                                                                                                                                                                                                                        //epsilon
                                                                                                                                                                                                                                                                                        if(!strcmp(first[add][addfirst1],"epsilon"))
                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                            if(text[j][epsilonindex2+1][0]!='\0')
                                                                                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                                                                                                                        epsiloncheck=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                        }//if(!strcmp(first[add][addfirst1],"epsilon"))
                                                                                                                                                                                                                                                                                                                    //epsilon
                                                                                                                                                                                                                                                                                                                    donotfind=1;
                                                                                                                                                                                                                                                                                                                                                for(addfirst2=1;first[posinfirst][addfirst2][0]!='\0'&&addfirst2<50;addfirst2++)
                                                                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                    if(!strcmp(first[posinfirst][addfirst2],first[add][addfirst1]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //printf("already add!%s",first[add][addfirst1]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    donotfind=0;break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }//if(!strcmp(first[posinfirst][addfirst2],first[add][addfirst1]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                }//for(addfirst2=1;first[posinfirst][addfirst2][0]!='\0'&&addfirst2<50;addfirst2++)
                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                            if(donotfind)
                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                strcpy(first[posinfirst][addfirst2],first[add][addfirst1]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                donotfind=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }//if(donotfind)
                                                                                                                                                                                                                                                                                                                                                                                                    }//for(addfirst1=1;first[add][addfirst1][0]!='\0'&&addfirst1<50;addfirst1++)
                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                            }//if(64<text[j][1][0]&&text[j][1][0]<91)
                                                                                                                                                                    


                                                                                                                                                                                    //smallcase
                                                                                                                                                                        else
                                                                                                                                                                                        {    
                                                                                                                                                                                                            
                                                                                                                                                                                                            donotfind=1;
                                                                                                                                                                                                                            for(addfirst2=1;first[posinfirst][addfirst2][0]!='\0'&&addfirst2<50;addfirst2++)
                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                if(!strcmp(first[posinfirst][addfirst2],text[j][1]))
                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                            donotfind=0;break;
                                                                                                                                                                                                                                                                                                                                                                                                            }//if(!strcmp(first[posinfirst][addfirst2],text[j][1]))
                                                                                                                                                                                                                                                                                                                            }//for(addfirst2=1;first[posinfirst][addfirst2][0]!='\0'&&addfirst2<50;addfirst2++)
                                                                                                                                                                                                                                                        if(donotfind)
                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                            strcpy(first[posinfirst][addfirst2],text[j][1]);
                                                                                                                                                                                                                                                                                                                                                            donotfind=0;
                                                                                                                                                                                                                                                                                                                                                                                        }//if(donotfind)
                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                               //smallcase

                                                                                                                                                                                    }//for(epsilonindex2=0;epsilonindex2<10;epsilonindex2++)
                                                                                                                    }//for(j=(i+1);j<100;j++)
                                                        return  posinfirst;
}




int followfunct(char* target)
{
        strcpy(follow[0][1],"$");
            int i,k,j,posinfirst,addfirst1,epsilonindex2,epsiloncheck,add,addfirst2,donotfind,posinfollow;
                int printuse;
                    for(i=0;i<99;i++)
                                {
                                                for(j=1;j<10&&text[i][j][0]!='\0';j++)
                                                                    {
                                                                                            
                                                                        /////////////////////////找text[i][j]在follow中的位置
                                                                                            for( posinfirst=0; posinfirst<100; posinfirst++)
                                                                                                                        {    
                                                                                                                                                        if(!strcmp(text[i][j],follow[ posinfirst][0]))
                                                                                                                                                                                            {    
                                                                                                                                                                                                                                    //printf("text[%d][%d]=%s\n",i,j,text[i][j]);
                                                                                                                                                                                                                                    break;
                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                }
                                                                                            /////////////////////////找text[i][j]在follow中的位置
                                                                                                                for(k=1;k<10&&text[i][j+k][0]!='\0';k++)
                                                                                                                                            {
                                                                                                                                                                            //printf("text[i][j+k]=%s  i=%d j=%d k=%d\n",text[i][j+k],i,j,k);
                                                                                                                                                                            ;//bigcase nonterminal
                                                                                                                                                                                                        if(64<text[i][j][0]&&text[i][j][0]<91)
                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                    ;
                                                                                                                                                                                                                                                                                                                        if(64<text[i][j+k][0]&&text[i][j+k][0]<91)
                                                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                                                                                    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                                                                                                                                                                                                                                                                                                                                                                                                                    //  把first都加入
                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                              add=firstfunct(text[i][j+k]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              //printf("first::%s_add",text[i][j+k]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          epsiloncheck=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      for(addfirst1=1;first[add][addfirst1][0]!='\0'&&addfirst1<50;addfirst1++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          {    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //epsilon
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if(!strcmp(first[add][addfirst1],"epsilon"))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              epsiloncheck=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }//if(!strcmp(first[add][addfirst1],"epsilon"))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          //epsilon
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          donotfind=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          //printf("_14_");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  for(addfirst2=1;follow[posinfirst][addfirst2][0]!='\0'&&addfirst2<50;addfirst2++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      //printf("_15_");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if(!strcmp(follow[posinfirst][addfirst2],first[add][addfirst1]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //printf("_16_");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          //printf("already add!%s",first[add][addfirst1]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          donotfind=0;break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }//if(!strcmp(first[posinfirst][addfirst2],first[add][addfirst1]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }//for(addfirst2=1;follow[posinfirst][addfirst2][0]!='\0'&&addfirst2<50;addfirst2++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              //printf("_17_");                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if(donotfind)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              //printf("_18_");    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              strcpy(follow[posinfirst][addfirst2],first[add][addfirst1]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if((!strcmp(follow[posinfirst][0],"VarDeclList")))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //printf("XDDDDDDDDDDDD");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //getchar();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if(!strcmp(first[add][addfirst1],"}"))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              //    printf("QQQQQQQQQQQ");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //getchar();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if((!strcmp(follow[posinfirst][0],"VarDeclList"))&&(!strcmp(first[add][addfirst1],"}")))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //printf("XDDDDDDDDDDDD");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //getchar();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              donotfind=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }//if(donotfind)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }//for(addfirst1=1;first[add][addfirst1][0]!='\0'&&addfirst1<50;addfirst1++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if(!epsiloncheck)break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                            else
                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                                                                                                                                                                                                                                                                                                                                                                                                                                                        //  把first都加入
                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  

                                                                                                                                                                                                                                                                                                                                                                                                                                                        epsiloncheck=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if(!strcmp("}",text[i][j+k]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            //printf("%s",follow[posinfirst][addfirst2][0]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //        getchar();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            //epsilon
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if(!strcmp(text[i][j+k],"epsilon"))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        epsiloncheck=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    continue;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }//if(!strcmp(first[add][addfirst1],"epsilon"))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //epsilon
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    donotfind=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //printf("_14_");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for(addfirst2=1;follow[posinfirst][addfirst2][0]!='\0'&&addfirst2<50;addfirst2++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //printf("_15_");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if(!strcmp(follow[posinfirst][addfirst2],text[i][j+k]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            //printf("_16_");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //if(!strcmp(follow[posinfirst][addfirst2],text[i][j+k]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //printf("already add!%s",first[add][addfirst1]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    donotfind=0;break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }//if(!strcmp(first[posinfirst][addfirst2],first[add][addfirst1]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }//for(addfirst2=1;follow[posinfirst][addfirst2][0]!='\0'&&addfirst2<50;addfirst2++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        //printf("_17_");                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if(donotfind)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        //printf("_18_");    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if(!strcmp(text[i][j+k],"}"))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            //printf("QAQAQAQAQAQ");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            //getchar();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        strcpy(follow[posinfirst][addfirst2],text[i][j+k]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        donotfind=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }//if(donotfind)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                            }//if(64<text[i][j][0]&&text[i][j][0]<91)
                                                                                                                                                                                                                                    //terminal
                                                                                                                                                                                                                                    else
                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                break;
                                                                                                                                                                                                                                                                                                                                                }//else
                                                                                                                                                                                                                                                            }//for(k=2;k<50&&text[i][k][0]!='\0';k++)
                                                                                                                                        
                                                                                                                if( follow[posinfirst][0][0]!='\0'&&i!=99)
                                                                                                                                    {    ;
                                                                                                                                                            //printf("\n");  
                                                                                                                                                            //for(printuse=0;printuse<50;printuse++)
                                                                                                                                                            //printf("%s_",follow[posinfirst][printuse]);
                                                                                                                                                            //printf("%s\n",text[i][j+1]);
                                                                                                                                                            //getchar();
                                                                                                                                                        }





                                                                                                                            
                                                                                                                                }//for(j=1;j<50&&text[i][j][0]!='\0';j++)
                                                        }//for(i=0;i<99;i++)
                    ///////////////////////////////////////////////////////////////////////////////開始做follow的最後一步
                    int op;

                    for(op=0;op<100;op++){
                        for(i=0;i<100;i++)
                        {
                                if(text[i][0][0]=='\0')continue;
                                    for(j=i+1;j<100&&text[j][1][0]!='\0';j++)
                                                {
                                                        ;
                                                                    k=1;
                                                                                while(text[j][k][0]!='\0')k++;
                                                                                            //printf("%s\n",text[j][k-1]);
                                                                                            for(k=k-1;text[j][k][0]!='\0';k--)
                                                                                                                {
                                                                                                                        ;
                                                                                                                        //bigcase non terminal
                                                                                                                                            if(64<text[j][k][0]&&text[j][k][0]<91)
                                                                                                                                                                        {
                                                                                                                                                                            ;
                                                                                                                                                                                                        ;    ;
                                                                                                                                                                                                                                    if(text[i][0][0]!='\0')
                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                //printf("a=%sb=%s\n",text[i][0],text[j][k]);
                                                                                                                                                                                                                                                                                                                 followaddfollow(text[i][0],text[j][k]);;
                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                //printf("%s::: %d\n",text[j][k],followepsiloncheckfunct(text[j][k]));
                                                                                                                                                                                                                                                                if(followepsiloncheckfunct(text[j][k]));
                                                                                                                                                                                                                                                                                            else break;
                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                else break;
                                                                                                                                                                                    ;
                                                                                                                                                                                                    }
                                                                                                        ;
                                                                                                                }
                                        ;

                        }
                    }
                    ///////////////////////////////////////////////////////////////////////////////開始做follow的最後一步

                        return  0;
}


int followaddfollow(char* a,char*b)
{
        int posinfirsta;
            int posinfirstb;
                
            /////////////////////////找char* a在follow中的位置
                                for( posinfirsta=0; posinfirsta<100; posinfirsta++)
                                                            {    
                                                                                            if(!strcmp(a,follow[ posinfirsta][0]))
                                                                                                                                {    
                                                                                                                                                                        //printf("\n\ntext[%d][%d]=%sfollow:%d\n",i,j,text[i][j], posinfirst);
                                                                                                                                                                        break;
                                                                                                                                                                                                        }
                                                                                                                    }
                                /////////////////////////char* a在follow中的位置
                                /////////////////////////找char*b在follow中的位置
                                                    for( posinfirstb=0; posinfirstb<100; posinfirstb++)
                                                                                {    
                                                                                                                if(!strcmp(b,follow[ posinfirstb][0]))
                                                                                                                                                    {    

                                                                                                                                                                                            //printf("\n\ntext[%d][%d]=%sfollow:%d\n",i,j,text[i][j], posinfirst);
                                                                                                                                                                                            break;
                                                                                                                                                                                                                            }
                                                                                                                                        }
                                                    /////////////////////////找char*b在follow中的位置
                                                    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                        int add=posinfirsta;
                                                            int epsiloncheck,addfirst1,addfirst2,donotfind;
                                                                                                        //  把first都加入
                                                                                
                                                                                                                              

                                                                                                        epsiloncheck=0;
                                                                                                                                                    for(addfirst1=1;follow[add][addfirst1][0]!='\0'&&addfirst1<50;addfirst1++)
                                                                                                                                                                                                        {    
                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                //epsilon
                                                                                                                                                                                                                                                                if(!strcmp(follow[add][addfirst1],"epsilon"))
                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                            epsiloncheck=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        //break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        continue;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }//if(!strcmp(follow[add][addfirst1],"epsilon"))
                                                                                                                                                                                                                                                                                                                        //epsilon
                                                                                                                                                                                                                                                                                                                        donotfind=1;
                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                for(addfirst2=1;follow[posinfirstb][addfirst2][0]!='\0'&&addfirst2<50;addfirst2++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                {//printf("_15_");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if(!strcmp(follow[posinfirstb][addfirst2],follow[add][addfirst1]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        //printf("already add!%s",first[add][addfirst1]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        donotfind=0;break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }//if(!strcmp(first[posinfirst][addfirst2],first[add][addfirst1]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }//for(addfirst2=1;follow[posinfirst][addfirst2][0]!='\0'&&addfirst2<50;addfirst2++)
                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                        if(donotfind)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            strcpy(follow[posinfirstb][addfirst2],follow[add][addfirst1]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            donotfind=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }//if(donotfind)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }//for(addfirst1=1;first[add][addfirst1][0]!='\0'&&addfirst1<50;addfirst1++)
                                                                                                                                                                            
                                                                                                                                                                        
                                                                                                                                                                
                                                                                                                                                    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                                                    //getchar();

                                                                                                                                                        return 0;
}


int followepsiloncheckfunct(char*a)
{
        int posinfirsta,add,addfirst1;
            int epsiloncheck=0;
                //return  0;
                
            /////////////////////////找char* a在follow中的位置
                                for( posinfirsta=0; posinfirsta<100; posinfirsta++)
                                                            {    
                                                                                            if(!strcmp(a,first[ posinfirsta][0]))
                                                                                                                                {    
                                                                                                                                                                        //printf("\n\ntext[%d][%d]=%sfollow:%d\n",i,j,text[i][j], posinfirst);
                                                                                                                                                                        break;
                                                                                                                                                                                                        }
                                                                                                                    }
                                /////////////////////////char* a在follow中的位置
                                add=posinfirsta;
                                                                            for(addfirst1=1;first[add][addfirst1][0]!='\0'&&addfirst1<50;addfirst1++)
                                                                                                                                {    
                                                                                                                                                                
                                                                                                                                                                                        //epsilon
                                                                                                                                                                                        if(!strcmp(first[add][addfirst1],"epsilon"))
                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                    epsiloncheck=1;
                                                                                                                                                                                                                                                                                                                                                                                break;
                                                                                                                                                                                                                                                                                                                                                                                                                                            //continue;
                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                        }//if(!strcmp(follow[add][addfirst1],"epsilon"))
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                        }//for(addfirst1=1;first[add][addfirst1][0]!='\0'&&addfirst1<50;addfirst1++)

                                                                                return  epsiloncheck;
}

int lltablemake()
{
        int i,j,k;
            for(i=0;i<98;i++)
                        {
                                        if(text[i][0][0]=='\0')continue;
                                                    for(j=i+1;j<98;j++)
                                                                        {
                                                                                                if(text[j][1][0]=='\0')break;
                                                                                                                    //printf("%s->",text[i][0]);
                                                                                                                    for(k=1;text[j][k][0]!='\0';k++)
                                                                                                                                                {
                                                                                                                                                                                //printf("%s_",text[j][k]);
                                                                                                                                                                                //big case nonterminal
                                                                                                                                                                                if(64<text[j][k][0]&&text[j][k][0]<91)
                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                            //addtoFlltable(follow,"Stmt",5,"$");
                                                                                                                                                                                                                                                            if(addtoFlltable(first,text[j][k], j,text[i][0]))
                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                        addtoFlltable(follow,text[i][0], j,text[i][0]);
                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                ;
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                            //terminal
                                                                                                                                                                                                            else
                                                                                                                                                                                                                                                {    
                                                                                                                                                                                                                                                                                        if(!strcmp(text[j][k],"epsilon"))
                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                                                    addtoFlltable(follow,text[i][0], j,text[i][0]);
                                                                                                                                                                                                                                                                                                                                                                                                                                ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                            jmaalpha( j,text[i][0],text[j][k]);
                                                                                                                                                                                                                                                                                                                                                                ;
                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                        break;//迴圈只做一次

                                                                                                                                                                                                                                                                }
                                                                                                                                        //printf("\n");
                                                                                                                                        ;
                                                                                                                                                        }
                                                                ;
                                                                        }
                return 0;
}


int terminalnum(char* a)
{
         
        int p;
            
            
            for(p=0;terminalk[p][0]!='\0';p++)
                        {
                                        
                                        //printf("_");
                                        if(!strcmp(terminalk[p],a))
                                                            {
                                                                                
                                                                                    //printf("terminalnum%d\n",p);
                                                                                    return p;
                                                                                                    }
                                                    
                                                }
                //printf("NO %s\n",a);
                ;return 0;
                    
}



int nonterminalnum(char*a)
{
        int p;
            
            
            for(p=0;terminal[p][0]!='\0';p++)
                        {
                                        
                                        //printf("_");
                                        if(!strcmp(terminal[p],a))
                                                            {
                                                                                    //printf("nonterminalnum%s%d\n",terminal[p],p);
                                                                                    return p;
                                                                                                    }
                                                    
                                                }
                //printf("NO %s\n",a);
                ;return 0;
}

int jmaalpha(int j,char* A,char* alpha)
{
        int i;
            for(i=0;i<30;i++)
                        {
                                        //不重複
                                        if(lltable[nonterminalnum(A)][terminalnum(alpha)][i]==j&&nonterminalnum(A)!=0&&terminalnum(alpha)!=0)
                                                            {
                                                                                    break;
                                                                                                                ;
                                                                                                                                }
                                                    if(lltable[nonterminalnum(A)][terminalnum(alpha)][i]==0&&nonterminalnum(A)!=0&&terminalnum(alpha)!=0)
                                                                        {
                                                                                                lltable[nonterminalnum(A)][terminalnum(alpha)][i]=j;
                                                                                                                    break;
                                                                                                                                    }
                                                            }
                return 0;
}


int addtoFlltable(char  followorfirst[100][50][30],char* nonterminal,int j,char* A)
{
        
        //followorfirst[(nonterminalnum(nonterminal)-1)][0];
        //printf("%s   ",followorfirst[(nonterminalnum(nonterminal)-1)][1]);
        int i,epsilon;
            epsilon=0;
                for(i=0;i<50&&followorfirst[(nonterminalnum(nonterminal)-1)][i][0]!='\0';i++)
                            {
                                //表格中的要減一才會等於followfirst陣列中的排序
                                            if(!strcmp(followorfirst[(nonterminalnum(nonterminal)-1)][i],"epsilon"))
                                                                {
                                                                                        epsilon=1;
                                                                                                            continue;
                                                                                                                            }
                                                         jmaalpha( j, A,followorfirst[(nonterminalnum(nonterminal)-1)][i]);    
                                                                     ;
                                                                             }
                    return epsilon;
}


//OK
int printlltable()
{
        //FILE* ll=fopen("lltable.txt","w");
        int i,j,k;
        ///////////////////////////////////////////
        fprintf(ll,"        S\n");
        fprintf(ll,"        S_     int____S->Program_$_\n");
        fprintf(ll,"        S_    char____S->Program_$_\n");
        fprintf(ll,"        S_  double____S->Program_$_\n");
        fprintf(ll,"        S_   float____S->Program_$_\n");
        fprintf(ll,"        S_       $____S->Program_$_\n");        

        ///////////////////////////////////////////
            for(i=1;i<30;i++)
                        {
                                        for(j=1;j<40;j++)
                                                            {
                                                                                    for(k=0;k<30;k++)
                                                                                                                {
                                                                                                                                                if(lltable[i][j][k]==0)
                                                                                                                                                                                {
                                                                                                                                                                                                                    continue;
                                                                                                                                                                                                                                                }
                                                                                                                                                                            else
                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                fprintf(ll,"%15s_%8s_",terminal[i], terminalk[j]);
                                                                                                                                                                                                                                                                                printf("%15s_%8s_",terminal[i], terminalk[j]);
                                                                                                                                                                                                                                                                                                                invertcheck( lltable[i][j][k]);
                                                                                                                                                                                                                                                                                                                                                //printf("%d____",k);
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                    }
                                                                                                        ;
                                                                                                                        }
                                                    ;
                                                            }
                return 0;
}




//OK
int invertcheck(int a)
{
    //FILE* ll=fopen("lltable.txt","w");
    //productionbuffer[10][20];
        int b,i;
            b=a;
                for(;text[b][0][0]=='\0';b--){;}
                    printf("___%s->",text[b][0]);
                        fprintf(ll,"___%s->",text[b][0]);
                            for(i=1;text[a][i][0]!='\0';i++)
                                        {
                                                        strcpy(productionbuffer[i-1],text[a][i]);
                                                                    printf("%s_",text[a][i]);;
                                                                                fprintf(ll,"%s_",text[a][i]);;
                                                                                            //printf("%s_",productionbuffer[i-1]);
                                                                                        }
                                printf("\n");
                                    fprintf(ll,"\n");
                                        strcpy(productionbuffer[i-1],"\0");
                                            return 0;
}


/*
   //////////////////////////////////////hw3
   int DeclListplon;
   char DeclListplonType[10];
   char DeclListplonId[100];
   int scoperecord[100];
   int nowscope;
   int STarray;
   int STfunct;
   int ParamDecl;
   struct symboltable SymbolTable[50];
   int symbolcount=0;
   //////////////////////////////////////hw3
   */

int maketree(char* non,int hir)
{
    //fprintf(code,"QQ\n");
        int secret;
            int i;
                char mybuffer[10][20];
                    //printf("hello\n");
                    
                    //token_fp= fopen("token.txt","r");;
                    /*
                           while(fscanf(token_fp,"%s%s",Type,word)!=EOF)
                               {
                                       //printf("%s %s\n",Type,word);
                                           } 
                                               */
                //印出
                    for(i=0;i<hir;i++)
                                {
                                                printf("  ");
                                                            fprintf(tree,"  ");
                                                                    }
                        printf("%d %s\n",hir,non);
                            fprintf(tree,"%d %s\n",hir,non);
                            //印出
                            //查表放暫存
                                //決定哪個直可以被放入
                                if(!terminalnum(word))
                                            {
                                                            strcpy(globalk,Type);
                                                                    }
                                    else
                                                {
                                                                strcpy(globalk,word);
                                                                            ;
                                                                                    }
                                        //printf("globalk%s",globalk);
                                        //決定哪個直可以被放入

                                         invertcheck(lltable[nonterminalnum(non)][terminalnum(globalk)][0]);    
                                             for(i=0;i<10&&productionbuffer[i][0]!='\0';i++)
                                                         {
                                                                         strcpy(mybuffer[i],productionbuffer[i]);
                                                                                     //printf("%d_%s",i,mybuffer[i]);
                                                                                     ;
                                                                                             }
                                                 strcpy(mybuffer[i],"\0");
                                                 //查表放暫存
                                                 //從第一到最後一個暫存
                                                 int j;
                                                     //迴圈  從這裡開始
                                                     for(i=0;i<10&&mybuffer[i][0]!='\0';i++)
                                                                 {    
                                                                                 
                                                                                 //nonterminal
                                                                                 if(64<mybuffer[i][0]&&mybuffer[i][0]<91)
                                                                                                     {    
                                                                                                                             //
                                                                                                                             if(strcmp(mybuffer[i],"VarDecl")==0)
                                                                                                                                                         {
                                                                                                                                                                                          VarDecl=1;
                                                                                                                                                                                                                      printf("VarDecl=1\n");
                                                                                                                                                                                                                                              }
                                                                                                                                                 if(strcmp(mybuffer[i],"DeclList'")==0)
                                                                                                                                                                             {
                                                                                                                                                                                                              DeclListplon=1;
                                                                                                                                                                                                                                          printf("DeclListplon=1\n");
                                                                                                                                                                                                                                                                  }
                                                                                                                                                                     if(strcmp(mybuffer[i],"ParamDecl")==0)
                                                                                                                                                                                                 {
                                                                                                                                                                                                                                  ParamDecl=1;
                                                                                                                                                                                                                                                              printf("ParamDecl=1\n");
                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                         if(strcmp(mybuffer[i],"FunDecl")==0)
                                                                                                                                                                                                                     {
                                                                                                                                                                                                                                                     FunDecl=1;
                                                                                                                                                                                                                                                                                 printf("oldscope:%d\n",nowscope);
                                                                                                                                                                                                                                                                                                             nowscope=scopein();
                                                                                                                                                                                                                                                                                                                                         //scopeup,down
                                                                                                                                                                                                                                                                                                                                         functleft=1;
                                                                                                                                                                                                                                                                                                                                                                     printf("FunDecl=1\n");
                                                                                                                                                                                                                                                                                                                                                                                                 //printf("declare:%s %s(){}; array=F funct=T scope=%d\n",DeclListplonType,DeclListplonId,nowscope);
                                                                                                                                                                                                                                                                                                                                                                                                 SymbolTable[symbolcount].array=0;
                                                                                                                                                                                                                                                                                                                                                                                                                             SymbolTable[symbolcount].funct=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                         SymbolTable[symbolcount].scope=nowscope;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     strcpy(SymbolTable[symbolcount].Symbol,DeclListplonId);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 strcpy(SymbolTable[symbolcount].Type,DeclListplonType);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             SymbolTable[symbolcount].para=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          registersupplier(SymbolTable[symbolcount].Symbol,1,0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      strcpy(SymbolTable[symbolcount].Rname,registernewname);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //fprintf(code,"\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  fprintf(code,"define %s %s( ) #0 {\n",(strcmp(SymbolTable[symbolcount].Type,"int")?"double":"i32"),SymbolTable[symbolcount].Rname);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if(strcmp(SymbolTable[symbolcount].Symbol,"main")==0)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          fprintf(code,"  %1 = alloca i32, align 4\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              fprintf(code," store i32 0, i32* %1\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          printf("declare:%s %s(){}; array=%d funct=%d scope=%d\n",SymbolTable[symbolcount].Type,SymbolTable[symbolcount].Symbol,SymbolTable[symbolcount].array,SymbolTable[symbolcount].funct,SymbolTable[symbolcount].scope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      symbolcount+=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //strcpy( VarDeclId,word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  DeclListplon=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      //函式宣告判定
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                             maketree(mybuffer[i],(hir+1));
                                                                                                                                                                                                                             }
                                                                                             //terminal
                                                                                             else
                                                                                                                 {
                                                                                                                                         
                                                                                                                                         if(strcmp(mybuffer[i],Type)==0)
                                                                                                                                                                     {

                                                                                                                                                                                                     for(j=0;j<(hir+1);j++)
                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                                                                 printf("  ");
                                                                                                                                                                                                                                                                                                                     fprintf(tree,"  ");
                                                                                                                                                                                                                                                                                                                                                     }
                                                                                                                                                                                                                                 printf("%d %saaa\n",(hir+1),Type);
                                                                                                                                                                                                                                                             fprintf(tree,"%d %s\n",(hir+1),Type);
                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                         for(j=0;j<(hir+2);j++)
                                                                                                                                                                                                                                                                                                                             {
                                                                                                                                                                                                                                                                                                                                                                     printf("  ");
                                                                                                                                                                                                                                                                                                                                                                                                         fprintf(tree,"  ");
                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                     printf("%d %sbbb\n",(hir+2),word);;
                                                                                                                                                                                                                                                                                                                                                 fprintf(tree,"%d %s\n",(hir+2),word);
                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                             if((strcmp(non,"VarDecl'")==0))
                                                                                                                                                                                                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                         if((DeclListplon==1)&&((strcmp(Type,"num")==0)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             {    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     SymbolTable[symbolcount].array=atoi(word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         SymbolTable[symbolcount].funct=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             SymbolTable[symbolcount].scope=nowscope;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 strcpy(SymbolTable[symbolcount].Symbol,DeclListplonId);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     strcpy(SymbolTable[symbolcount].Type,DeclListplonType);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         SymbolTable[symbolcount].para=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              registersupplier(SymbolTable[symbolcount].Symbol,1,0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              strcpy(SymbolTable[symbolcount].Rname,registernewname);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //fprintf(code,"\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  //fprintf(code,"%s = common global %s %s, align %s\n",SymbolTable[symbolcount].Rname,(strcmp(SymbolTable[symbolcount].Type,"int")?"double":"i32"),(strcmp(SymbolTable[symbolcount].Type,"int")?"0.000000e+00":"0"),(strcmp(SymbolTable[symbolcount].Type,"int")?"8":"4"));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  fprintf(code,"%s = common global [%d x %s] zeroinitializer, align %s\n",SymbolTable[symbolcount].Rname,SymbolTable[symbolcount].array,(strcmp(SymbolTable[symbolcount].Type,"int")?"double":"i32"),(strcmp(SymbolTable[symbolcount].Type,"int")?"8":"4"));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      printf("declarearrayout:%s %s [%d]; array=%d funct=%dscope=%d\n",SymbolTable[symbolcount].Type,SymbolTable[symbolcount].Symbol,SymbolTable[symbolcount].array,SymbolTable[symbolcount].array,SymbolTable[symbolcount].funct,SymbolTable[symbolcount].scope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          symbolcount+=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              //外部陣列宣告判定
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ;        DeclListplon=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     if((VarDecl==1)&&((strcmp(Type,"num")==0)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 //printf("declarefunctinarray:%s %s [%s]; array=T funct=F scope=%d\n",VarDeclType,VarDeclId,word,nowscope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 //內部陣列宣告判定
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 SymbolTable[symbolcount].array=atoi(word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     SymbolTable[symbolcount].funct=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         SymbolTable[symbolcount].scope=nowscope;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             strcpy(SymbolTable[symbolcount].Symbol,VarDeclId);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 strcpy(SymbolTable[symbolcount].Type,VarDeclType);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     SymbolTable[symbolcount].para=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          registersupplier(SymbolTable[symbolcount].Symbol,nowscope,0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        strcpy(SymbolTable[symbolcount].Rname,registernewname);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            fprintf(code,"%s = alloca [%d x %s], align %s\n",SymbolTable[symbolcount].Rname,SymbolTable[symbolcount].array,(strcmp(SymbolTable[symbolcount].Type,"int")?"double":"i32"),(strcmp(SymbolTable[symbolcount].Type,"int")?"8":"4"));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("declarefunctinarray:%s %s [%d]; array=%d funct=%dscope=%d\n",SymbolTable[symbolcount].Type,SymbolTable[symbolcount].Symbol,SymbolTable[symbolcount].array,SymbolTable[symbolcount].array,SymbolTable[symbolcount].funct,SymbolTable[symbolcount].scope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    symbolcount+=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ;        VarDecl=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                         if((strcmp(Type,"id")==0))
                                                                                                                                                                                                                                                                                                                                                                                                                                             {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     if(DeclListplon==1)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 printf("DeclListplonId\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             strcpy( DeclListplonId,word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         if(ParamDecl==1)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     printf("ParamDeclId\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 strcpy( ParamDeclId,word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             if(VarDecl==1)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         printf("VarDeclId\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     strcpy( VarDeclId,word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                             else
                                                                                                                                                                                         {
                                                                                                                                                                                             //printf("XD5");
                                                                                                                                                                                                                         
                                                                                                                                                                                                                         for(j=0;j<(hir+1);j++)
                                                                                                                                                                                                                                                             {
                                                                                                                                                                                                                                                                                                     printf("  ");
                                                                                                                                                                                                                                                                                                                                         fprintf(tree,"  ");
                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                     if(strcmp("epsilon",mybuffer[i])==0)
                                                                                                                                                                                                                                                                                     {
                                                                                                                                                                                                                                                                                                                     printf("%d %s\n",(hir+1),"epsilon");
                                                                                                                                                                                                                                                                                                                                                 fprintf(tree,"%d %s\n",(hir+1),"epsilon");
                                                                                                                                                                                                                                                                                                                                                                             if((strcmp(non,"ParamDecl'")==0))
                                                                                                                                                                                                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                         if((ParamDecl==1))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     //printf("declare functin:%s %s ; array=F funct=F scope=%d\n",ParamDeclType,ParamDeclId,nowscope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     //涵室內變數宣告判定
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     SymbolTable[symbolcount].array=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         SymbolTable[symbolcount].funct=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             SymbolTable[symbolcount].scope=nowscope;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 strcpy(SymbolTable[symbolcount].Symbol,ParamDeclId);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     strcpy(SymbolTable[symbolcount].Type,ParamDeclType);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         SymbolTable[symbolcount].para=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              registersupplier(SymbolTable[symbolcount].Symbol,nowscope,0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            strcpy(SymbolTable[symbolcount].Rname,registernewname);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                printf("declare functinpara:%s %s  array=%d funct=%dscope=%d\n",SymbolTable[symbolcount].Type,SymbolTable[symbolcount].Symbol,SymbolTable[symbolcount].array,SymbolTable[symbolcount].funct,SymbolTable[symbolcount].scope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    symbolcount+=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ;        ParamDecl=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }
                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                 else
                                                                                                                                                                                                                                                                                                                     {
                                                                                                                                                                                                                                                                                                                                                             printf("%d %sccc\n",(hir+1),word);
                                                                                                                                                                                                                                                                                                                                                                                                 fprintf(tree,"%d %s\n",(hir+1),word);
                                                                                                                                                                                                                                                                                                                                                                                                                                     if((strcmp(word,"{")==0)&&(functleft!=1))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 nowscope=scopein();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                         if((strcmp(word,"{")==0)&&(functleft==1))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     functleft=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             if((strcmp(word,"}")==0))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         nowscope=scopeout(nowscope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     printf("scopeout\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 if((strcmp(non,"Type")==0))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             if(DeclListplon==1)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         printf("DeclListplonType\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             strcpy( DeclListplonType,word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         if(ParamDecl==1)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     printf("ParamDeclType\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         strcpy( ParamDeclType,word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     if(VarDecl==1)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 printf("VarDeclType\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     strcpy( VarDeclType,word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     if((strcmp(non,"VarDecl'")==0))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 if((DeclListplon==1)&&((strcmp(word,";")==0)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             //printf("declarevarout:%s %s ; array=F funct=F scope=%d\n",DeclListplonType,DeclListplonId,nowscope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             //外部變數宣告判定
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             SymbolTable[symbolcount].array=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 SymbolTable[symbolcount].funct=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     SymbolTable[symbolcount].scope=nowscope;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         strcpy(SymbolTable[symbolcount].Symbol,DeclListplonId);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             strcpy(SymbolTable[symbolcount].Type,DeclListplonType);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 SymbolTable[symbolcount].para=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      registersupplier(SymbolTable[symbolcount].Symbol,1,0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    strcpy(SymbolTable[symbolcount].Rname,registernewname);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        fprintf(code,"%s = common global %s %s, align %s\n",SymbolTable[symbolcount].Rname,(strcmp(SymbolTable[symbolcount].Type,"int")?"double":"i32"),(strcmp(SymbolTable[symbolcount].Type,"int")?"0.000000e+00":"0"),(strcmp(SymbolTable[symbolcount].Type,"int")?"8":"4"));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            printf("declare functoutvar:%s %s  ;array=%d funct=%dscope=%d\n",SymbolTable[symbolcount].Type,SymbolTable[symbolcount].Symbol,SymbolTable[symbolcount].array,SymbolTable[symbolcount].funct,SymbolTable[symbolcount].scope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                symbolcount+=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ;        DeclListplon=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             if((VarDecl==1)&&((strcmp(word,";")==0)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         //printf("declarevarin:%s %s ; array=F funct=F scope=%d\n",VarDeclType,VarDeclId,nowscope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         SymbolTable[symbolcount].array=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             SymbolTable[symbolcount].funct=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 SymbolTable[symbolcount].scope=nowscope;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     strcpy(SymbolTable[symbolcount].Symbol,VarDeclId);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         strcpy(SymbolTable[symbolcount].Type,VarDeclType);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             SymbolTable[symbolcount].para=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  registersupplier(SymbolTable[symbolcount].Symbol,nowscope,0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                strcpy(SymbolTable[symbolcount].Rname,registernewname);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    fprintf(code,"%s = alloca %s , align %s\n",SymbolTable[symbolcount].Rname,(strcmp(SymbolTable[symbolcount].Type,"int")?"double":"i32"),(strcmp(SymbolTable[symbolcount].Type,"int")?"8":"4"));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        //%yyy = alloca i32, align 4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        printf("declare functinvar:%s %s  array=%d funct=%dscope=%d\n",SymbolTable[symbolcount].Type,SymbolTable[symbolcount].Symbol,SymbolTable[symbolcount].array,SymbolTable[symbolcount].funct,SymbolTable[symbolcount].scope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            symbolcount+=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //內部變數宣告判定
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ;        VarDecl=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         if((strcmp(non,"ParamDecl'")==0))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     if((ParamDecl==1)&&((strcmp(word,"[")==0)))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 //printf("declarefunctinarray:%s %s [ ] ; array=T funct=F scope=%d\n",ParamDeclType,ParamDeclId,nowscope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 //涵室內陣列para宣告判定
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 SymbolTable[symbolcount].array=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     SymbolTable[symbolcount].funct=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         SymbolTable[symbolcount].scope=nowscope;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             strcpy(SymbolTable[symbolcount].Symbol,ParamDeclId);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 strcpy(SymbolTable[symbolcount].Type,ParamDeclType);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     SymbolTable[symbolcount].para=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         printf("declarefunctinarraypara:%s %s [ ]  array=%d funct=%dscope=%d\n",SymbolTable[symbolcount].Type,SymbolTable[symbolcount].Symbol,SymbolTable[symbolcount].array,SymbolTable[symbolcount].funct,SymbolTable[symbolcount].scope);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             symbolcount+=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ;        ParamDecl=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                             ////////////////////////////////////////////////////////////////////////////讀字
                                                                                                                                                                                 if(strcmp("epsilon",mybuffer[i])==0)
                                                                                                                                                                                                             {
                                                                                                                                                                                                                                             //printf("XD6");
                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                             ;
                                                                                                                                                                                                                                                                     }
                                                                                                                                                                                                     else
                                                                                                                                                                                                                                         {
                                                                                                                                                                                                                                             //printf("XD7");
                                                                                                                                                                                                                                                                                 secret=0;
                                                                                                                                                                                                                                                                                                                     while(fscanf(token_fp,"%s%s",Type,word)!=EOF)
                                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                 printf("%s %s\n",Type,word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                             if(!terminalnum(word))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         strcpy(globalk,Type);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             //printf("globalk%s\n",globalk);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         else
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     strcpy(globalk,word);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         //printf("globalk%s\n",globalk);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     secret=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         } 
                                                                                                                                                                                                                                                                                                                                                             if(secret==0)
                                                                                                                                                                                                                                                                                                                                                                                                             {
                                                                                                                                                                                                                                                                                                                                                                                                                 //printf("================================================================================================================\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                 strcpy(Type,"$");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 strcpy(word,"$");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 strcpy(globalk,"$");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             }
                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                 ;
                                                                                                                                                                                                                                                                                                                                                                                                                                 }
                                                                                                                                                                                                     ////////////////////////////////////////////////////////////////////////////讀字
                                                                                                                                                                                                                         ;
                                                                                                                                                                                                                                         }
                                                                                                         ;
                                                                                                                 }    
                                                     //從第一到最後一個暫存
                                                     /*for(i=0;i<10&&mybuffer[i][0]!='\0';i++)
                                                       {
                                                           printf("%s",mybuffer[i]);
                                                           }
                                                           printf("%d end\n",hir);*/
                                                         if(strcmp( non,"FunDecl")==0)fprintf(code,"}\n");
                                                             return 0;
}
//XDDDD


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
int scopein()
{
        int find=0;
            int i;
                int a=nowscope;
                    int pos;
                        for(i=0;(i<6)&&(a>0);i++)
                                    {
                                                    a=a/10;
                                                            }
                            printf("%d?%d",nowscope,i);
                                pos=i;
                                    a=nowscope;
                                        int a1=1;
                                            for(i=0;(i<6)&&(pos>0);i++)
                                                        {
                                                                        a1=a1*10;
                                                                                    pos-=1;
                                                                                            }
                                                printf("a1:%d",a1);
                                                    int j ;
                                                        for(i=1;i<10;i++)
                                                                    {
                                                                                    a=a+a1;
                                                                                                find=0;
                                                                                                            for(j=1;(j<100)&&(scoperecord[j]!=0);j++)
                                                                                                                                {
                                                                                                                                                        if(a==scoperecord[j])
                                                                                                                                                                                    {
                                                                                                                                                                                                                    find=1;
                                                                                                                                                                                                                                                break;
                                                                                                                                                                                                                                                                        }
                                                                                                                                                                            printf("scoperecord[%d]=%d\n",j,scoperecord[j]);
                                                                                                                                                                                                
                                                                                                                                                                                            }    
                                                                                                                        if(find==0)
                                                                                                                                            {
                                                                                                                                                                    scoperecord[j]=a;
                                                                                                                                                                                        printf("returnscoperecord[%d]=%d\n",j,scoperecord[j]);
                                                                                                                                                                                                            return a;
                                                                                                                                                                                                                                ;
                                                                                                                                                                                                                                                }

                                                                                                                                }
                                                            
                                                            return 0;
}
int scopeout(int nowscope)
{
        printf("scopeout\n");
            int find=0;
                int i;
                    int a=nowscope;
                        int pos;
                            for(i=0;(i<6)&&(a>0);i++)
                                        {
                                                        a=a/10;
                                                                }
                                printf("%d?%d",nowscope,i);
                                    pos=i;
                                        a=nowscope;
                                            int a1=1;
                                                for(i=0;(i<6)&&(pos>0);i++)
                                                            {
                                                                            a1=a1*10;
                                                                                        pos-=1;
                                                                                                }
                                                    a1=a1/10;
                                                        printf("a1:%d",a1);
                                                            int j ;
                                                                for(i=1;i<10;i++)
                                                                            {
                                                                                            a=a-a1;
                                                                                                        
                                                                                                        if(!(a>0))
                                                                                                                            {
                                                                                                                                                    a=a+a1;
                                                                                                                                                                        printf("a=%d",a);
                                                                                                                                                                                            return a;
                                                                                                                                                                                                                break;
                                                                                                                                                                                                                                }

                                                                                                                }
                                                                    
                                                                    return 0;
}

int registersupplier(char id[100],int scopenum,int instruction)
{
        
        int i;
            symbolcountf=1;
                //int symbolcount=0;
                //int registercount=1;
                //int nowR=0;
                //char registernewname[15];
                //registernewname="@";
                //        strcat(registernewname,id);
                char str[10];
                    //int a=1234;
                    //sprintf(str,"%d",a);
                    int find;        
                        if(instruction==1)
                                    {
                                                    
                                                    strcpy(registernewname,"%");
                                                                sprintf(str,"%d",(registercount+1));
                                                                            strcat(registernewname,str);
                                                                                        registercount=registercount+1;
                                                                                                    return 0;
                                                                                                            }
                            else
                                        {
                                                        if(scopenum==1)
                                                                            {
                                                                                                    strcpy(registernewname,"@");
                                                                                                                        
                                                                                                                        strcat(registernewname,id);
                                                                                                                                            
                                                                                                                                        }
                                                                    else
                                                                                        {
                                                                                                                strcpy(registernewname,"%");
                                                                                                                                    strcat(registernewname,id);
                                                                                                                                                        find=0;
                                                                                                                                                                            for(i=0;i<(nowR);i++)
                                                                                                                                                                                                        {
                                                                                                                                                                                                                                        if(strcmp(registernewname,R[i])==0)
                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                    //find=1;
                                                                                                                                                                                                                                                                                                                    printf("find\n");
                                                                                                                                                                                                                                                                                                                                                        sprintf(str,"%d",(symbolcountf));
                                                                                                                                                                                                                                                                                                                                                                                            strcat(registernewname,str);
                                                                                                                                                                                                                                                                                                                                                                                                                                symbolcount+=1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    i=-1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                strcpy(R[nowR],registernewname);
                                                                                                                                                                                                                    nowR+=1;
                                                                                                                                                                                                                                    }
                                                                            }
                                printf(" registersupplier:%s\n",registernewname);
                                    return 0 ;
}

int FtableI(char id[100],int nowscopel)
{
    // SymbolTable[i]
    //    int scope;
    //    char Symbol[100];
    //    char Type[10];
    //    int array;
    //    int  funct;
    //    int para;
    //    char Rname[15];
    int i;
    int find;
    int k;
    for(;nowscopel>0;){
         for(i=0;i<50;i++)
                     {
                                     if(strcmp(SymbolTable[i].Symbol,"")==0){printf("break");break;}
                                                 if(strcmp(SymbolTable[i].Symbol,id)==0)
                                                                     {
                                                                                             k=i;
                                                                                                                 find+=1;
                                                                                                                                     if(nowscopel==SymbolTable[i].scope)return i;
                                                                                                                                                     }
                                                             
                                                         }
                 if(find==0)break;
                         nowscopel=scopeout(nowscopel);
                             }    

     if(find==0)return 100;
}
